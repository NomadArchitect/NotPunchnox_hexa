<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://threejs.org/build/three.js"></script>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>

<body>

    <script>
        // Fonction pour convertir les degrés en radians
        function degToRad(degrees) {
            return degrees * (Math.PI / 180);
        }

        // Fonction pour créer un vecteur avec la longueur et l'angle spécifiés
        function createVector(length, angle) {
            var vector = new THREE.Vector3();
            vector.setFromSphericalCoords(length, degToRad(angle), Math.PI / 2);
            return vector;
        }

        // Initialisation de la scène, de la caméra et du rendu
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Calcul des positions des articulations et des extrémités des segments
        var hauteur = 8;
        var extensionLeg = 15.26; // distance entre le bout de la patte et le coxa
        var coxaLength = 5;
        var femur = 6;
        var tibia = 13.5;

        // Angles donnés
        var femurAngle = 59.88;
        var tibiaAngle =  95.22;

        // Positions des articulations et des extrémités des segments
        var coxaPosition = new THREE.Vector3(0, 8, hauteur);
        var femurPosition = coxaPosition.clone().add(createVector(coxaLength, 90)); // Utilisez l'angle du coxa ici
        var tibiaPosition = femurPosition.clone().add(createVector(femur, femurAngle)); // Utilisez l'angle du femur ici
        var endEffectorPosition = tibiaPosition.clone().add(createVector(tibia, femurAngle + (180 - tibiaAngle))); // Utilisez l'angle du tibia ici

        // Vecteur d'extension
        var extensionVector = createVector(extensionLeg, 270);

        // Création de lignes pour représenter les segments
        var coxaLine = new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(), coxaPosition]),
            new THREE.LineBasicMaterial({
                color: 0xff0000
            }));
        var femurLine = new THREE.Line(new THREE.BufferGeometry().setFromPoints([coxaPosition, femurPosition]),
            new THREE.LineBasicMaterial({
                color: 0xff0000
            }));
        var tibiaLine = new THREE.Line(new THREE.BufferGeometry().setFromPoints([femurPosition, tibiaPosition]),
            new THREE.LineBasicMaterial({
                color: 0xff0000
            }));
        var endEffectorLine = new THREE.Line(new THREE.BufferGeometry().setFromPoints([tibiaPosition,
            endEffectorPosition
        ]), new THREE.LineBasicMaterial({
            color: 0xff0000
        }));
        var extensionLine = new THREE.Line(new THREE.BufferGeometry().setFromPoints([endEffectorPosition,
            endEffectorPosition.clone().add(extensionVector)
        ]), new THREE.LineBasicMaterial({
            color: 0x00ff00
        }));

        // Ajout des lignes à la scène
        scene.add(coxaLine);
        scene.add(femurLine);
        scene.add(tibiaLine);
        scene.add(endEffectorLine);
        scene.add(extensionLine);

        // Positionnement de la caméra
        camera.position.z = 30;

        function addAngleAnnotation(point1, point2, length, angle, label) {
            var angleVector = createVector(length * 1.5, angle);
            var midPoint = point1.clone().add(point2).multiplyScalar(0.5);
            var annotationPosition = midPoint.clone().add(angleVector);

            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');
            context.font = '12px Arial';
            context.fillStyle = '#000000';
            context.fillText(label, 0, 12);

            var texture = new THREE.CanvasTexture(canvas);
            var material = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: true
            });
            material.side = THREE.DoubleSide;

            var planeGeometry = new THREE.PlaneGeometry(1, 0.5);
            var plane = new THREE.Mesh(planeGeometry, material);

            plane.position.copy(annotationPosition);
            scene.add(plane);
        }

        // Fonction d'animation
        function animate() {
            requestAnimationFrame(animate);

            // Animation des lignes en fonction des angles
            femurLine.geometry.setFromPoints([coxaPosition, femurPosition]);
            tibiaLine.geometry.setFromPoints([femurPosition, tibiaPosition]);
            endEffectorLine.geometry.setFromPoints([tibiaPosition, endEffectorPosition]);
            extensionLine.geometry.setFromPoints([endEffectorPosition, endEffectorPosition.clone().add(extensionVector)]);

            // Ajout des annotations d'angle
            addAngleAnnotation(coxaPosition, femurPosition, coxaLength, 90, "Coxa");
            addAngleAnnotation(femurPosition, tibiaPosition, femur, femurAngle, "Femur");
            addAngleAnnotation(tibiaPosition, endEffectorPosition, tibia, 90 + tibiaAngle, "Tibia");

            renderer.render(scene, camera);
        }

        animate();

        
    </script>

</body>

</html>